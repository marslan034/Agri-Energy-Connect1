@{
    ViewData["Title"] = "Farmer Dashboard";
}

<h2>Welcome, Farmer!</h2>

<form id="productForm">
    <div class="mb-3">
        <label for="productName" class="form-label">Product Name</label>
        <input type="text" class="form-control" id="productName" required>
    </div>
    <div class="mb-3">
        <label for="productType" class="form-label">Product Type</label>
        <input type="text" class="form-control" id="productType" required>
    </div>
    <div class="mb-3">
        <label for="productionDate" class="form-label">Production Date</label>
        <input type="date" class="form-control" id="productionDate" required>
    </div>
    <button type="submit" class="btn btn-primary">Add Product</button>
</form>

<hr>

<h4>Your Products</h4>
<ul id="productList" class="list-group"></ul>

<script>
    const db = firebase.firestore();
    const user = firebase.auth().currentUser;

    firebase.auth().onAuthStateChanged(function(user) {
        if (user) {
            loadProducts(user.uid);

            document.getElementById("productForm").addEventListener("submit", function (e) {
                e.preventDefault();
                const name = document.getElementById("productName").value;
                const type = document.getElementById("productType").value;
                const date = document.getElementById("productionDate").value;

                db.collection("products").add({
                    name: name,
                    type: type,
                    date: date,
                    farmerId: user.uid
                }).then(() => {
                    alert("✅ Product added");
                    loadProducts(user.uid);
                });
            });
        }
    });

    function loadProducts(uid) {
        db.collection("products").where("farmerId", "==", uid).get().then((querySnapshot) => {
            const list = document.getElementById("productList");
            list.innerHTML = "";
            querySnapshot.forEach((doc) => {
                const data = doc.data();
                const li = document.createElement("li");
                li.className = "list-group-item";
                li.textContent = `${data.name} (${data.type}) - ${data.date}`;
                list.appendChild(li);
            });
        });
    }
</script>
